<?xml version="1.0" encoding="UTF-8"?>
<beans 
	xmlns="http://www.springframework.org/schema/beans"
    xmlns:p="http://www.springframework.org/schema/p"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:util="http://www.springframework.org/schema/util"
	xmlns:cache="http://www.springframework.org/schema/cache"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/mvc 
		http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/util 
        http://www.springframework.org/schema/util/spring-util.xsd
		http://www.springframework.org/schema/context 
		http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/cache 
        http://www.springframework.org/schema/cache/spring-cache.xsd" >
 
	<!-- DispatcherServlet Context: defines this servlet's request-processing infrastructure -->
	<mvc:default-servlet-handler />

	<!-- Handles HTTP GET requests for /resources/** by efficiently serving up static resources in the ${webappRoot}/resources directory -->
	<!-- 스프링의 DispatcherServet에게 정적인 자원을 알려준다.  -->
	<mvc:resources mapping="/resources/**" location="/resources/" />
	<mvc:resources mapping="/images/**"    location="/images/" />
	<mvc:resources mapping="/css/**"       location="/css/"    />

	
	<!-- Enables the Spring MVC @Controller programming model -->
	<mvc:annotation-driven />
	
    <context:component-scan base-package="com.wsc"/>
    <context:component-scan base-package="com.lsbas.service"/>

	<util:properties id="app" location="classpath:app.properties"/>

    <bean id="wscCacheManager" class="org.springframework.cache.ehcache.EhCacheCacheManager">
        <property name="cacheManager">
            <bean class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean">
                <property name="configLocation" value="classpath:ehcache.xml"/>
                <property name="shared" value="true"/>
            </bean>
        </property>
    </bean>
 
    <cache:annotation-driven cache-manager="wscCacheManager" />

	<bean id="sessionFactory" class="org.springframework.beans.factory.config.ObjectFactoryCreatingFactoryBean">
		<property name="targetBeanName" value="sessionComponent" />
	</bean>

	<!-- Resolves views selected for rendering by @Controllers to .jsp resources in the /WEB-INF/views directory -->
	<bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix" value="/WEB-INF/views/" />
		<property name="suffix" value=".jsp" />
		<property name="order"  value="99" />
	</bean>
    <!-- Bean Name View Resolver -->
    <bean class="org.springframework.web.servlet.view.BeanNameViewResolver">
        <property name="order"  value="0" />
    </bean>
    <bean class="org.springframework.web.servlet.view.XmlViewResolver">
        <property name="location" value="/WEB-INF/spring/wsc-jasper.xml"/>
        <property name="order" value="1"/>
    </bean>
	<import resource="wsc-jasper.xml"/>
	<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
        <property name="maxUploadSize"   value="524288000" /><!-- 500 MB -->
        <property name="maxInMemorySize" value="10485760"  /><!--  10 MB -->
        <property name="uploadTempDir"   ref="uploadDirResource" />
	</bean>

	<bean id="uploadDirResource" class="org.springframework.core.io.FileSystemResource">
    	<constructor-arg>
       		<value>#{app['file.upload.temp']}</value>
    	</constructor-arg>
 	</bean>
 	
    <!-- Simple Mapping Exception Resolver -->
    <bean class="org.springframework.web.servlet.handler.SimpleMappingExceptionResolver">
		<property name="warnLogCategory" value="apperror" />
        <property name="defaultErrorView" value="error/system" />
        <property name="exceptionMappings">
            <props>
                <prop key="com.wsc.framework.exception.SessionException"  >error/session</prop>
                <prop key="com.wsc.framework.exception.AuthorityException">error/authority</prop>
                <prop key="com.wsc.framework.exception.ServiceException"  >error/service</prop>
                <prop key="com.wsc.framework.exception.SystemException"   >error/system</prop>
                <prop key="java.lang.Exception"   >error/system</prop>
            </props>
        </property>
    </bean>

    <bean id="jsonView" class="org.springframework.web.servlet.view.json.MappingJacksonJsonView" />
    <bean id="jxlsView" class="com.wsc.framework.view.JxlsView" />
    <bean id="fileView" class="com.wsc.framework.view.FileView" />

	<!-- org.springframework.context.support.ResourceBundleMessageSource -->
    <bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
        <property name="basenames">
            <list>
                <value>classpath:/messages/message</value>
            </list>
        </property>
        <property name="defaultEncoding">
            <value>UTF-8</value>
        </property>
    </bean>
    <bean id="localeResolver" class="org.springframework.web.servlet.i18n.SessionLocaleResolver">
    	<property name="defaultLocale" value="ko" />
    </bean>
	
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- Interceptor                                                         -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
	<mvc:interceptors>
	    <!-- Security Interceptor -->
		<bean class="com.wsc.common.security.SecurityInterceptor" />
		<bean class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor">
			<property name="paramName" value="lang" />
		</bean>
	</mvc:interceptors>

	<!-- Root Context: defines shared resources visible to all other web components -->
	<import resource="wsc-mybatis.xml" />
	<import resource="cxf-servlet.xml" />
</beans>
